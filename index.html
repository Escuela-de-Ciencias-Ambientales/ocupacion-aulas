<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OcupaciÃ³n de Aulas</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BASE & VARIABLES â€” TEMA CLARO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg:            #f1f5f9;
      --surface:       #ffffff;
      --border:        #e2e8f0;
      --border-strong: #cbd5e1;
      --accent:        #1d4ed8;
      --accent2:       #059669;
      --muted:         #94a3b8;
      --text:          #0f172a;
      --text-dim:      #64748b;
      --cell-h:        42px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem 4rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header { text-align: center; margin-bottom: 2.5rem; }
    .logo-row {
      display: flex; align-items: center; justify-content: center;
      gap: .75rem; margin-bottom: .5rem;
    }
    .logo-dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(29,78,216,.3);
    }
    h1 {
      font-size: clamp(1.4rem, 4vw, 2.2rem);
      font-weight: 600; letter-spacing: -.02em; color: var(--text);
    }
    .subtitle { font-size: .9rem; color: var(--text-dim); margin-top: .3rem; }
    .updated {
      display: inline-block; margin-top: .8rem;
      font-family: 'DM Mono', monospace; font-size: .75rem;
      color: var(--muted); background: var(--surface);
      border: 1px solid var(--border-strong);
      padding: .25rem .75rem; border-radius: 999px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEGEND
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .legend {
      display: flex; gap: 1.5rem; justify-content: center;
      margin-bottom: 1.5rem; flex-wrap: wrap;
    }
    .legend-item { display: flex; align-items: center; gap: .5rem; font-size: .8rem; color: var(--text-dim); }
    .legend-box  { width: 16px; height: 16px; border-radius: 4px; }
    .lb-free { background: #f8fafc; border: 1px solid var(--border-strong); }
    .lb-am   { background: #2563eb; }
    .lb-pm   { background: #059669; }
    .lb-ev   { background: #7c3aed; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABLE WRAPPER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .table-wrap {
      max-width: 1100px; margin: 0 auto; overflow-x: auto;
      border-radius: 16px; border: 1px solid var(--border-strong);
      box-shadow: 0 4px 24px rgba(15,23,42,.08);
    }
    table { width: 100%; border-collapse: collapse; min-width: 680px; background: var(--surface); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER ROW
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    thead tr { background: #f8fafc; }
    th {
      padding: .75rem 1rem; font-size: .72rem; font-weight: 700;
      letter-spacing: .08em; text-transform: uppercase;
      color: var(--text-dim); border-bottom: 2px solid var(--border-strong); white-space: nowrap;
    }
    th:first-child { border-radius: 16px 0 0 0; }
    th:last-child  { border-radius: 0 16px 0 0; }
    th.col-room    { text-align: left; padding-left: 1.5rem; min-width: 90px; }
    th.col-jornada { min-width: 80px; }
    th.col-day     { min-width: 130px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BODY ROWS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    tbody tr { border-bottom: 1px solid var(--border); }
    tbody tr:last-child { border-bottom: none; }
    td { height: var(--cell-h); vertical-align: middle; font-size: .82rem; }

    /* Room label */
    td.td-room {
      padding-left: 0; text-align: center; font-family: 'DM Mono', monospace;
      font-size: .85rem; font-weight: 600; color: var(--accent);
      background: #f8fafc; border-right: 1px solid var(--border-strong);
      border-bottom: none; white-space: nowrap; vertical-align: middle;
    }
    .row-pm td.td-room, .row-ev td.td-room { border-top: none; border-bottom: none; }

    /* Jornada */
    td.td-jornada {
      padding: 0 .75rem; font-size: .68rem; font-weight: 700;
      letter-spacing: .07em; text-transform: uppercase;
      border-right: 1px solid var(--border); white-space: nowrap;
    }
    .row-am td.td-jornada { color: #1d4ed8; background: rgba(37,99,235,.05); }
    .row-pm td.td-jornada { color: #059669; background: rgba(5,150,105,.05); }
    .row-ev td.td-jornada { color: #7c3aed; background: rgba(124,58,237,.05); }

    /* Quitar borde interno entre filas del mismo aula */
    .row-pm td, .row-ev td { border-top: none; }
    /* Solo separar entre aulas distintas */
    tr.room-sep td { border-top: 2px solid var(--border-strong); }

    /* Day cells */
    td.td-day {
      padding: 0 .75rem; border-right: 1px solid var(--border);
      text-align: center; transition: background .15s; cursor: default;
    }
    td.td-day:last-child { border-right: none; }

    /* Occupied â€” light tinted */
    td.td-day.occupied-am { background: #eff6ff; color: #1e40af; font-weight: 500; }
    td.td-day.occupied-pm { background: #f0fdf4; color: #166534; font-weight: 500; }
    td.td-day.occupied-ev { background: #faf5ff; color: #6b21a8; font-weight: 500; }

    /* Empty */
    td.td-day:not(.occupied-am):not(.occupied-pm):not(.occupied-ev) {
      background: transparent; color: #cbd5e1;
    }

    .cell-content {
      font-size: .78rem; line-height: 1.2; white-space: nowrap;
      overflow: hidden; text-overflow: ellipsis; max-width: 120px; margin: 0 auto;
    }
    .cell-empty { font-size: .65rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ADMIN BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .admin-trigger {
      position: fixed; bottom: 1.5rem; right: 1.5rem;
      background: var(--surface); border: 1px solid var(--border-strong);
      color: var(--muted); border-radius: 8px; padding: .45rem .8rem;
      font-size: .7rem; font-family: 'DM Mono', monospace;
      cursor: pointer; transition: all .2s; z-index: 100;
      box-shadow: 0 2px 8px rgba(15,23,42,.1);
    }
    .admin-trigger:hover { border-color: var(--accent); color: var(--accent); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-bg {
      display: none; position: fixed; inset: 0;
      background: rgba(15,23,42,.35); backdrop-filter: blur(4px);
      z-index: 200; align-items: center; justify-content: center;
    }
    .modal-bg.open { display: flex; }
    .modal {
      background: var(--surface); border: 1px solid var(--border-strong);
      border-radius: 16px; padding: 2rem; width: min(480px, 92vw);
      box-shadow: 0 20px 60px rgba(15,23,42,.15);
    }
    .modal h2 { font-size: 1.1rem; font-weight: 600; margin-bottom: 1.25rem; color: var(--text); }
    .modal label { display: block; font-size: .78rem; color: var(--text-dim); margin-bottom: .4rem; }
    .modal input, .modal select {
      width: 100%; background: var(--bg); border: 1px solid var(--border-strong);
      border-radius: 8px; color: var(--text); padding: .6rem .9rem;
      font-family: 'DM Sans', sans-serif; font-size: .9rem;
      margin-bottom: 1rem; outline: none; transition: border-color .2s;
    }
    .modal input:focus, .modal select:focus { border-color: var(--accent); }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      padding: .6rem 1.2rem; border-radius: 8px; font-size: .85rem;
      font-weight: 600; cursor: pointer; border: none; transition: all .2s;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: #1e40af; }
    .btn-ghost { background: transparent; border: 1px solid var(--border-strong); color: var(--text-dim); }
    .btn-ghost:hover { border-color: #94a3b8; color: var(--text); }
    .btn-danger { background: #dc2626; color: #fff; }
    .btn-danger:hover { background: #b91c1c; }
    .btn-row { display: flex; gap: .75rem; justify-content: flex-end; margin-top: .5rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EXPORT BOX
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .export-box {
      display: none; max-width: 1100px; margin: 2rem auto 0;
      background: var(--surface); border: 1px solid var(--border-strong);
      border-radius: 12px; padding: 1.5rem;
    }
    .export-box.open { display: block; }
    .export-box h3 { font-size: .9rem; color: var(--accent); margin-bottom: .75rem; }
    .export-box p { font-size: .8rem; color: var(--text-dim); margin-bottom: .75rem; line-height: 1.6; }
    .export-box pre {
      background: var(--bg); border: 1px solid var(--border-strong); border-radius: 8px;
      padding: 1rem; font-family: 'DM Mono', monospace; font-size: .72rem; color: #475569;
      overflow-x: auto; max-height: 280px; white-space: pre-wrap; word-break: break-all;
    }
    .copy-btn { margin-top: .75rem; font-size: .78rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast {
      position: fixed; bottom: 5rem; right: 1.5rem;
      background: #fff; border: 1px solid var(--accent2); color: var(--accent2);
      border-radius: 8px; padding: .6rem 1rem; font-size: .82rem;
      opacity: 0; transition: opacity .3s; z-index: 300; pointer-events: none;
      box-shadow: 0 4px 16px rgba(15,23,42,.1);
    }
    .toast.show { opacity: 1; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ADMIN TOOLBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #admin-toolbar {
      display: none; position: fixed; top: 0; left: 0; right: 0;
      background: #fff; border-bottom: 2px solid var(--accent);
      padding: .6rem 1.5rem; align-items: center; gap: 1rem;
      z-index: 150; flex-wrap: wrap;
      box-shadow: 0 2px 12px rgba(15,23,42,.08);
    }

    @media (max-width: 600px) {
      body { padding: 1rem .5rem 4rem; }
      td.td-room { padding-left: .75rem; font-size: .75rem; }
      td.td-day  { padding: 0 .4rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo-row">
    <div class="logo-dot"></div>
    <h1>OcupaciÃ³n de Aulas</h1>
    <div class="logo-dot"></div>
  </div>
  <p class="subtitle">Escuela de Ciencias Ambientales â€” EDECA</p>
  <span class="updated" id="updated-label">Actualizado: â€”</span>
</header>

<div class="legend">
  <div class="legend-item"><div class="legend-box lb-free"></div> Disponible</div>
  <div class="legend-item"><div class="legend-box lb-am"></div> Ocupada (MaÃ±ana)</div>
  <div class="legend-item"><div class="legend-box lb-pm"></div> Ocupada (Tarde)</div>
  <div class="legend-item"><div class="legend-box lb-ev"></div> Ocupada (Noche)</div>
</div>

<div class="table-wrap">
  <table id="schedule-table">
    <thead>
      <tr>
        <th class="col-room">Aula</th>
        <th class="col-jornada">Jornada</th>
        <th class="col-day">Lunes</th>
        <th class="col-day">Martes</th>
        <th class="col-day">MiÃ©rcoles</th>
        <th class="col-day">Jueves</th>
        <th class="col-day">Viernes</th>
        <th class="col-day">SÃ¡bado</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>
</div>

<div class="export-box" id="export-box">
  <h3>ğŸ”§ Instrucciones para guardar cambios permanentes</h3>
  <p>
    Los cambios estÃ¡n guardados en <em>este navegador</em>.
    Para que <strong>todos los visitantes</strong> vean los cambios, copia el bloque de abajo
    y pÃ©galo en el archivo <code>index.html</code> en GitHub, reemplazando la variable <code>SCHEDULE_DATA</code>.
  </p>
  <pre id="export-pre"></pre>
  <button class="btn btn-ghost copy-btn" onclick="copyExport()">ğŸ“‹ Copiar datos</button>
</div>

<button class="admin-trigger" onclick="showLogin()">âš™ Admin</button>
<div class="toast" id="toast"></div>

<!-- LOGIN MODAL -->
<div class="modal-bg" id="login-modal">
  <div class="modal">
    <h2>ğŸ”’ Acceso de administrador</h2>
    <label>ContraseÃ±a</label>
    <input type="password" id="pwd-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')checkLogin()" />
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModal('login-modal')">Cancelar</button>
      <button class="btn btn-primary" onclick="checkLogin()">Entrar</button>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-bg" id="edit-modal">
  <div class="modal">
    <h2 id="edit-modal-title">Editar celda</h2>
    <label>Contenido de la celda</label>
    <input type="text" id="edit-text" placeholder="Ej: Prof. RamÃ­rez" maxlength="60" />
    <p style="font-size:.75rem;color:var(--muted);margin-top:-.5rem;margin-bottom:1rem;">
      Deja vacÃ­o para marcar como disponible.
    </p>
    <div class="btn-row">
      <button class="btn btn-danger" onclick="clearCell()">Limpiar</button>
      <button class="btn btn-ghost" onclick="closeModal('edit-modal')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveCell()">Guardar</button>
    </div>
  </div>
</div>

<!-- MANAGE ROOMS MODAL -->
<div class="modal-bg" id="addrow-modal">
  <div class="modal">
    <h2>â• Gestionar aulas</h2>
    <label>Nueva aula (ej: 712, LAB-604)</label>
    <input type="text" id="newroom-input" placeholder="Nombre del aula" maxlength="20" />
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModal('addrow-modal')">Cancelar</button>
      <button class="btn btn-primary" onclick="addRoom()">Agregar aula</button>
    </div>
    <hr style="border-color:var(--border-strong);margin:1rem 0;" />
    <p style="font-size:.78rem;color:var(--text-dim);margin-bottom:.75rem;">Eliminar aula existente:</p>
    <select id="delete-room-select"></select>
    <div class="btn-row" style="margin-top:.25rem">
      <button class="btn btn-danger" onclick="deleteRoom()">Eliminar aula</button>
    </div>
  </div>
</div>

<!-- ADMIN TOOLBAR -->
<div id="admin-toolbar">
  <span style="font-size:.75rem;font-family:'DM Mono',monospace;color:var(--accent);font-weight:700;">MODO ADMIN</span>
  <button class="btn btn-ghost" style="font-size:.75rem;" onclick="showAddRow()">â• Aulas</button>
  <button class="btn btn-ghost" style="font-size:.75rem;" onclick="toggleExport()">ğŸ“‹ Ver instrucciones</button>
  <button class="btn btn-ghost" style="font-size:.75rem;" onclick="exitAdmin()">âœ• Salir</button>
  <span style="font-size:.72rem;color:var(--muted);margin-left:auto;">Haz clic en cualquier celda para editarla</span>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATOS DEL HORARIO â€” EDITAR ESTA SECCIÃ“N EN GITHUB
   Estructura: "AULA": { "am"/"pm"/"ev": { "DÃ­a":"texto", ... } }
   Texto vacÃ­o "" = disponible
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SCHEDULE_DATA = {
  "708": {
    "am": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"Federico Alice", "Jueves":"", "Viernes":"", "SÃ¡bado":"MarÃ­a Gamboa" },
    "pm": { "Lunes":"Victor Meza", "Martes":"Igor ZuÃ±iga", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"Sherryl Campos" },
    "ev": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"", "Jueves":"Sherryl Campos", "Viernes":"Nancy Zamora", "SÃ¡bado":"" }
  },
  "709": {
    "am": { "Lunes":"Gustavo Hernandez", "Martes":"Federico Alice", "MiÃ©rcoles":"Ronny Villalobos", "Jueves":"", "Viernes":"Ernesto Montero", "SÃ¡bado":"" },
    "pm": { "Lunes":"", "Martes":"JosÃ© Rojas", "MiÃ©rcoles":"Sergio Molina", "Jueves":"Jesus Ugalde", "Viernes":"Manfred Murrel", "SÃ¡bado":"" },
    "ev": { "Lunes":"", "Martes":"Karla Vetrani", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" }
  },
  "710": {
    "am": { "Lunes":"", "Martes":"Alina Aguilar", "MiÃ©rcoles":"Albert Morera", "Jueves":"MarÃ­a Chaves", "Viernes":"Vanessa Valerio", "SÃ¡bado":"" },
    "pm": { "Lunes":"MarÃ­a Loria", "Martes":"Roy Cruz", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"Karla Vetrani", "SÃ¡bado":"" },
    "ev": { "Lunes":"Maria BolaÃ±os", "Martes":"", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" }
  },
  "711": {
    "am": { "Lunes":"Ronny Villalobos", "Martes":"", "MiÃ©rcoles":"Sergio Molina", "Jueves":"", "Viernes":"", "SÃ¡bado":"" },
    "pm": { "Lunes":"Igor ZuÃ±iga", "Martes":"MarÃ­a Alvarez", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"Vanessa Valerio", "SÃ¡bado":"" },
    "ev": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"", "Jueves":"Nancy Zamora", "Viernes":"", "SÃ¡bado":"" }
  },
  "LAB-601": {
    "am": { "Lunes":"Pablo Ramirez", "Martes":"Luis Diego Alfaro", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" },
    "pm": { "Lunes":"JosÃ© Castro", "Martes":"", "MiÃ©rcoles":"Roy Cruz", "Jueves":"", "Viernes":"", "SÃ¡bado":"" },
    "ev": { "Lunes":"Max Arguedas", "Martes":"DamiÃ¡n Sanchez", "MiÃ©rcoles":"Luis Diego Alfaro", "Jueves":"", "Viernes":"", "SÃ¡bado":"" }
  },
  "LAB-602": {
    "am": { "Lunes":"Manfred Murrel", "Martes":"JosÃ© Rojas", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" },
    "pm": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"MarÃ­a Gamboa", "Jueves":"MarÃ­a Chaves", "Viernes":"", "SÃ¡bado":"" },
    "ev": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" }
  },
  "LAB-603": {
    "am": { "Lunes":"Gustavo Vargas", "Martes":"Marco Otarola", "MiÃ©rcoles":"MarÃ­a Avellan", "Jueves":"Marco Otarola", "Viernes":"", "SÃ¡bado":"" },
    "pm": { "Lunes":"Rafael Murillo", "Martes":"Gustavo Vargas", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" },
    "ev": { "Lunes":"", "Martes":"", "MiÃ©rcoles":"", "Jueves":"", "Viernes":"", "SÃ¡bado":"" }
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURACIÃ“N
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ADMIN_PASSWORD = "admin2024"; // â† Cambia esto

const DAYS = ["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"];
let data      = JSON.parse(localStorage.getItem("schedule"))  || deepClone(SCHEDULE_DATA);
let roomOrder = JSON.parse(localStorage.getItem("roomOrder")) || Object.keys(SCHEDULE_DATA);
let isAdmin   = false;
let editTarget = null;

function deepClone(o) { return JSON.parse(JSON.stringify(o)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";

  roomOrder.forEach((room, idx) => {
    if (!data[room]) return;
    ["am","pm","ev"].forEach(period => {
      const tr = document.createElement("tr");
      tr.classList.add(period === "am" ? "row-am" : period === "pm" ? "row-pm" : "row-ev");
      if (period === "am" && idx > 0) tr.classList.add("room-sep");

      const tdRoom = document.createElement("td");
      tdRoom.className = "td-room";
      tdRoom.textContent = period === "am" ? room : "";
      tr.appendChild(tdRoom);

      const tdJ = document.createElement("td");
      tdJ.className = "td-jornada";
      tdJ.textContent = period === "am" ? "MAÃ‘ANA" : period === "pm" ? "TARDE" : "NOCHE";
      tr.appendChild(tdJ);

      const periodLabel = period === "am" ? "MaÃ±ana" : period === "pm" ? "Tarde" : "Noche";

      DAYS.forEach(day => {
        const val = (data[room][period] || {})[day] || "";
        const td  = document.createElement("td");
        td.className = "td-day";
        if (val) {
          td.classList.add(period === "am" ? "occupied-am" : period === "pm" ? "occupied-pm" : "occupied-ev");
          td.innerHTML = `<div class="cell-content" title="${val}">${val}</div>`;
        } else {
          td.innerHTML = `<span class="cell-empty">â€”</span>`;
        }
        if (isAdmin) {
          td.style.cursor = "pointer";
          td.title = `Editar: ${room} / ${periodLabel} / ${day}`;
          td.addEventListener("click", () => openEdit(room, period, day));
        }
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });

  const ts = localStorage.getItem("scheduleUpdated");
  document.getElementById("updated-label").textContent =
    ts ? `Actualizado: ${ts}` : "Actualizado: â€”";
  updateExport();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showLogin() {
  document.getElementById("pwd-input").value = "";
  openModal("login-modal");
  setTimeout(() => document.getElementById("pwd-input").focus(), 100);
}
function checkLogin() {
  if (document.getElementById("pwd-input").value === ADMIN_PASSWORD) {
    isAdmin = true;
    closeModal("login-modal");
    document.getElementById("admin-toolbar").style.display = "flex";
    document.body.style.paddingTop = "52px";
    render();
    showToast("âœ“ Modo admin activo");
  } else {
    showToast("âŒ ContraseÃ±a incorrecta", true);
    document.getElementById("pwd-input").value = "";
  }
}
function exitAdmin() {
  isAdmin = false;
  document.getElementById("admin-toolbar").style.display = "none";
  document.getElementById("export-box").classList.remove("open");
  document.body.style.paddingTop = "";
  render();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EDIT CELL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openEdit(room, period, day) {
  editTarget = { room, period, day };
  const val = (data[room][period] || {})[day] || "";
  const lbl = period === "am" ? "MaÃ±ana" : period === "pm" ? "Tarde" : "Noche";
  document.getElementById("edit-modal-title").textContent = `âœ ${room} Â· ${lbl} Â· ${day}`;
  document.getElementById("edit-text").value = val;
  openModal("edit-modal");
  setTimeout(() => document.getElementById("edit-text").focus(), 100);
}
function saveCell() {
  if (!editTarget) return;
  const { room, period, day } = editTarget;
  if (!data[room][period]) data[room][period] = {};
  data[room][period][day] = document.getElementById("edit-text").value.trim();
  persist(); closeModal("edit-modal"); render(); showToast("âœ“ Celda actualizada");
}
function clearCell() {
  document.getElementById("edit-text").value = ""; saveCell();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ROOMS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showAddRow() {
  const sel = document.getElementById("delete-room-select");
  sel.innerHTML = "";
  roomOrder.forEach(r => { const o = document.createElement("option"); o.value = r; o.textContent = r; sel.appendChild(o); });
  openModal("addrow-modal");
}
function addRoom() {
  const name = document.getElementById("newroom-input").value.trim().toUpperCase();
  if (!name) return showToast("Escribe el nombre del aula", true);
  if (data[name]) return showToast("El aula ya existe", true);
  const e = {}; DAYS.forEach(d => e[d] = "");
  data[name] = { am: {...e}, pm: {...e}, ev: {...e} };
  roomOrder.push(name);
  persist(); closeModal("addrow-modal"); render(); showToast(`âœ“ Aula ${name} agregada`);
}
function deleteRoom() {
  const name = document.getElementById("delete-room-select").value;
  if (!name || !confirm(`Â¿Eliminar el aula ${name}?`)) return;
  delete data[name];
  roomOrder = roomOrder.filter(r => r !== name);
  persist(); closeModal("addrow-modal"); render(); showToast(`âœ“ Aula ${name} eliminada`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PERSIST & EXPORT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function persist() {
  const now = new Date().toLocaleString("es-CR", { dateStyle:"short", timeStyle:"short" });
  localStorage.setItem("schedule",        JSON.stringify(data));
  localStorage.setItem("roomOrder",       JSON.stringify(roomOrder));
  localStorage.setItem("scheduleUpdated", now);
}
function updateExport() {
  const o = {}; roomOrder.forEach(r => { if (data[r]) o[r] = data[r]; });
  document.getElementById("export-pre").textContent = "const SCHEDULE_DATA = " + JSON.stringify(o, null, 2) + ";";
}
function toggleExport() { document.getElementById("export-box").classList.toggle("open"); updateExport(); }
function copyExport() {
  navigator.clipboard.writeText(document.getElementById("export-pre").textContent)
    .then(() => showToast("âœ“ Datos copiados"))
    .catch(() => showToast("Selecciona y copia manualmente", true));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id)  { document.getElementById(id).classList.add("open"); }
function closeModal(id) { document.getElementById(id).classList.remove("open"); }
document.querySelectorAll(".modal-bg").forEach(bg => {
  bg.addEventListener("click", e => { if (e.target === bg) bg.classList.remove("open"); });
});
let toastTimer;
function showToast(msg, isErr = false) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.borderColor = isErr ? "#dc2626" : "var(--accent2)";
  t.style.color       = isErr ? "#dc2626" : "var(--accent2)";
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove("show"), 2500);
}

render();
</script>
</body>
</html>
